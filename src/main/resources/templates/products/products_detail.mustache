{{>main/header}}

<style>

    /* ì§„í–‰ ìƒíƒœë°” ì»¨í…Œì´ë„ˆ */
.progress-container {
    position: relative;
    width: 100%;
    height: 70px; /* ë†’ì´ë¥¼ ì¡°ê¸ˆ ëŠ˜ë¦½ë‹ˆë‹¤ */
    margin: 20px 0;
}

.progress-bar {
    position: absolute;
    top: 38%; /* ì¤‘ì•™ ì •ë ¬ */
    left: 10%; /* Qualification ì›ì˜ ì¤‘ì•™ì—ì„œ ì‹œì‘í•˜ë„ë¡ ì¡°ì •í•©ë‹ˆë‹¤ */
    transform: translateY(-50%);
    width: 0;
    height: 10px;
    background-color: green;
    transition: width 0.4s ease;
}

.progress-steps {
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
    width: 100%;
    margin: 20px 0;
    gap: clamp(50px, 30vw, 400px);
}

.step {
    width: 30px;
    height: 30px;
    border: 2px solid #ccc;
    border-radius: 50%;
    display: inline-block;
    position: relative;
    text-align: center;
    line-height: 30px;
    font-weight: bold;
    color: #fff;
    background-color: #ccc;
    transition: background-color 0.3s ease, border-color 0.3s ease;
}

/* í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
.step::after {
    content: attr(data-step);
    position: absolute;
    top: 40px; /* ë™ê·¸ë¼ë¯¸ ì•„ë˜ì— í…ìŠ¤íŠ¸ ë°°ì¹˜ */
    left: 50%;
    transform: translateX(-50%);
    color: #000;
    font-weight: normal;
    font-size: 14px;
}

/* ìƒíƒœë³„ ë™ê·¸ë¼ë¯¸ ìƒ‰ìƒ */

.step.available.active {
    background-color: blue;
    border-color: blue;
}

.step.discontinued.active {
    background-color: gray;
    border-color: gray;
}

.step.out_of_stock.active {
    background-color: red;
    border-color: red;
}
</style>

<div id="layoutSidenav_content">
    <main>
        <div class="container-fluid px-4">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h1 class="mt-4">Products</h1>
                <button onclick="location.href='/products'" class="back-btn">ğŸ”™</button>
            </div>
            <ol class="breadcrumb mb-4">
                <li class="breadcrumb-item active">Products</li>
            </ol>

            <div class="card mb-4">
                <div class="card-header">
                    <i class="fas fa-table me-1"></i>
                    Products detail
                </div>
                <div class="card-body">

                    <table id="products_detail">
                        {{#products}}
                            <!-- ë²„íŠ¼ ì»¨í…Œì´ë„ˆ -->
                            <div class="button-container mb-3">
                                <a href="/products/detail/create" id="createButton" class="btn btn-custom-create btn-sm">
                                    <i class="fas fa-plus-circle"></i> ì‹ ê·œ
                                </a>

                                {{#productId}}
                                    <button id="deleteButton" class="btn btn-custom-delete btn-sm">
                                        <i class="fas fa-trash-alt"></i> ì‚­ì œ
                                    </button>
                                {{/productId}}
                                <a href="/products" class="btn btn-custom-select btn-sm" id="selectButton">
                                    <i class="fas fa-list"></i> ëª©ë¡
                                </a>
                            </div>

                            <!-- í¼ ì‹œì‘ -->
                            {{#productId}}
                            <form id="productForm" action="/products/detail/{{productId}}/update" method="POST">
                            {{/productId}}
                            {{^productId}}
                            <form id="productForm" action="/products/detail/create" method="POST">
                            {{/productId}}

                            <div class="mb-3 row">
                                <label for="productName" class="col-sm-2 col-form-label">ì œí’ˆëª…:</label>
                                <div class="col-sm-10">
                                    <input type="text" class="form-control" id="productName" name="productName" value="{{productName}}" placeholder="ì˜ˆ: AI Cloud" required>
                                </div>
                            </div>

                            <div class="mb-3 row">
                                <label for="category" class="col-sm-2 col-form-label">ì œí’ˆêµ°:</label>
                                <div class="col-sm-10">
                                    <input type="text" class="form-control" id="productFamily" name="productFamily" value="{{#productFamily}}{{productFamily}}{{/productFamily}}{{^productFamily}}{{/productFamily}}" placeholder="ì˜ˆ: AI Contact Center">
                                </div>
                            </div>

                            <div class="mb-3 row">
                                <label for="fixedPrice" class="col-sm-2 col-form-label">ì›ê°€:</label>
                                <div class="col-sm-10">
                                    <input type="text" class="form-control currency-input" id="fixedPrice" name="fixedPrice"
                                           value="{{ fixedPrice }}" placeholder="ì˜ˆ: 50,000" required>
                                </div>
                            </div>

                            <div class="mb-3 row">
                                <label for="dealerPrice" class="col-sm-2 col-form-label">ë”œëŸ¬ê°€:</label>
                                <div class="col-sm-10">
                                    <input type="text" class="form-control currency-input" id="dealerPrice" name="dealerPrice"
                                           value="{{ dealerPrice }}" placeholder="ì˜ˆ: 45,000" required>
                                </div>
                            </div>

                            <div class="mb-3 row">
                                <label for="costPrice" class="col-sm-2 col-form-label">ì •ì°°ê°€:</label>
                                <div class="col-sm-10">
                                    <input type="text" class="form-control currency-input" id="costPrice" name="costPrice"
                                           value="{{ costPrice }}" placeholder="ì˜ˆ: 55,000" required>
                                </div>
                            </div>

                            <div class="mb-3 row">
                                <label for="status" class="col-sm-2 col-form-label">ìƒíƒœ:</label>
                                <div class="col-sm-10">
                                    <select class="form-control" id="productCondition" name="productCondition" required>
                                        <option value="available">available</option>
                                        <option value="out_of_stock">out_of_stock</option>
                                        <option value="discontinued">discontinued</option>
                                    </select>
                                </div>
                            </div>

                            <div class="mb-3 row">
                                <label for="category" class="col-sm-2 col-form-label">ì œí’ˆ ì„¤ëª…:</label>
                                <div class="col-sm-10">
                                    <input type="text" class="form-control" id="productDescription" name="productDescription" value="{{#productDescription}}{{productDescription}}{{/productDescription}}{{^productDescription}}{{/productDescription}}" placeholder="ì œí’ˆ ì„¤ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.(50ì ì´ë‚´)">
                                </div>
                            </div>

                            <div class="d-flex justify-content-end">
                                <button type="submit" id="updateButton" class="btn btn-custom-update btn-sm">
                                    <i class="fas fa-save"></i> ì €ì¥
                                </button>
                            </div>
                        </form>
                        {{/products}}
                    </form>
                    </table>
                </div>
            </div>

        {{#productId}}
        <div class="card mb-4">
            <div class="card-header">
                <i class="fas fa-table me-1"></i>
                Product Status
            </div>
            <div class="card-body">
                <table id="products_status">

                    {{#products}}
                        <tbody>
                        <div class="progress-container">
                            <div class="progress-steps">
                                <div class="step available" data-step="available"></div>
                                <div class="step out_of_stock" data-step="out_of_stock"></div>
                                <div class="step discontinued" data-step="discontinued"></div>
                            </div>
                        </div>
                        </tbody>
                    {{/products}}
                </table>
            </div>
        </div>
        {{/productId}}
        </div>
    </main>

    <script>
        // CRUD ë©”ì‹œì§€
        {{#message}}
            alert("{{message}}");
        {{/message}}



        // ì´ˆê¸°ê°’ ì„¤ì •
        // ì›í™” í‘œì‹œ
        document.addEventListener("DOMContentLoaded", function () {
    let inputs = document.querySelectorAll(".currency-input");

    // ğŸ”¹ ì´ˆê¸°ê°’ì„ ì›í™”(â‚©) í˜•ì‹ìœ¼ë¡œ ë³€í™˜
    inputs.forEach(input => {
        if (input.value) {
            input.value = formatCurrency(input.value); // ì´ˆê¸°ê°’ ì›í™” ë³€í™˜
        }

        // ğŸ”¹ ì…ë ¥í•  ë•Œ ì›í™” í˜•ì‹ ì ìš©
        input.addEventListener("input", function () {
            let numericValue = input.value.replace(/[^0-9]/g, ''); // ìˆ«ìë§Œ ë‚¨ê¸°ê¸°
            if (numericValue) {
                input.value = formatCurrency(numericValue);
            }
        });

        // ğŸ”¹ í¼ ì œì¶œ ì‹œ ìˆ«ìë§Œ ì„œë²„ë¡œ ì „ì†¡ (â‚©, , ì œê±°)
        input.form.addEventListener("submit", function () {
            let numericValue = input.value.replace(/[^0-9]/g, ''); // ìˆ«ìë¡œ ë³€í™˜
            input.value = numericValue;
        });
    });
});

// ì›í™” í¬ë§· í•¨ìˆ˜ (â‚© ì ìš©)
function formatCurrency(value) {
    let number = parseFloat(value);
    if (!isNaN(number)) {
        return new Intl.NumberFormat('ko-KR', { style: 'currency', currency: 'KRW' }).format(number);
    }
    return value;
}

    {{#products}}
        document.addEventListener("DOMContentLoaded", function() {
            var productCondition = "{{productCondition}}";

            // ìƒíƒœì— ë”°ë¥¸ ì§„í–‰ìƒí™© í‘œì‹œ
            var progressSteps = document.querySelectorAll(".step");
            var steps = ["available", "out_of_stock", "discontinued"];
            var currentIndex = steps.indexOf(productCondition);

            // ì§„í–‰ìƒí™©ì— í•´ë‹¹í•˜ëŠ” ë™ê·¸ë¼ë¯¸ë§Œ ì±„ìš°ê¸°
            if (currentIndex !== -1) {
                progressSteps[currentIndex].classList.add("active");
            }

            // í¼ì— ë°ì´í„° ì±„ìš°ê¸°
            var productConditionSelect = document.getElementById("productCondition");
            if (productConditionSelect) {
                productConditionSelect.value = productCondition;
            }

            var form = document.getElementById("productForm");
            var currentUrl = window.location.pathname;
            if (form && currentUrl === "/products/detail/create") {
                form.action = "/products/detail/create";
            }

        {{#productId}}
        var deleteButton = document.getElementById("deleteButton");
        if (deleteButton) {
            deleteButton.addEventListener("click", function () {
                // ì„œë²„ì—ì„œ ë Œë”ë§ëœ productId ê°€ì ¸ì˜¤ê¸°
                var productId = "{{productId}}";

                if (productId) {
                    var confirmDelete = confirm("í˜„ì¬ í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?");
                    if (confirmDelete) {
                        fetch(`/products/detail/${productId}/delete`, {
                            method: "POST", // ì„œë²„ ì—”ë“œí¬ì¸íŠ¸ê°€ POSTë¥¼ ì§€ì›í•´ì•¼ í•¨
                            headers: {
                                "Content-Type": "application/json",
                            },
                            body: JSON.stringify({ id: productId }), // ì˜¬ë°”ë¥¸ ë°ì´í„° ì „ì†¡
                        })
                            .then((response) => {
                                if (response.ok) {
                                    alert("ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
                                    window.location.href = "/products"; // ì‚­ì œ í›„ ì´ë™
                                } else {
                                    alert("ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                                }
                            })
                            .catch((error) => {
                                console.error("Error:", error);
                                alert("ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                            });
                    }
                } else {
                    alert("ì‚­ì œí•  IDê°€ ì—†ìŠµë‹ˆë‹¤.");
                }
            });
            }
    {{/productId}}
        });
    {{/products}}
        document.addEventListener("DOMContentLoaded", function () {
    var updateButton = document.getElementById("updateButton");

    if (!updateButton) {
        console.error("âŒ updateButtonì„ ì°¾ì„ ìˆ˜ ì—†ìŒ! ë²„íŠ¼ì´ HTMLì— ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.");
    } else {
        console.log("âœ… updateButton ì°¾ìŒ! ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ ì¤‘...");

        updateButton.addEventListener("click", function (event) {
            console.log("ğŸ›  updateButton í´ë¦­ë¨! confirm() ì‹¤í–‰ ì˜ˆì •...");

            var confirmSave = confirm("ë³€ê²½ì‚¬í•­ì„ ì €ì¥í•˜ê² ìŠµë‹ˆê¹Œ?");
            if (!confirmSave) {
                console.log("âŒ ì‚¬ìš©ìê°€ ì·¨ì†Œë¥¼ ëˆŒë €ìŠµë‹ˆë‹¤.");
                event.preventDefault();
            } else {
                console.log("âœ… ì‚¬ìš©ìê°€ í™•ì¸ì„ ëˆŒë €ìŠµë‹ˆë‹¤. ì €ì¥ ì§„í–‰!");
            }
        });
    }
});


        document.addEventListener("DOMContentLoaded", function () {
        const form = document.getElementById("productForm");

        form.addEventListener("submit", function (event) {
            event.preventDefault(); // í¼ ì œì¶œ ë°©ì§€

            if (validateForm()) {
                form.submit(); // ê²€ì¦ í†µê³¼ ì‹œ ì œì¶œ
            }
        });

        function validateForm() {
            let isValid = true;

            // ì œí’ˆëª… ê²€ì¦ (í•„ìˆ˜ ì…ë ¥)
            const productName = document.getElementById("productName");
            if (!productName.value.trim()) {
                alert("ì œí’ˆëª…ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.");
                isValid = false;
            }

            // ê°€ê²© ê²€ì¦ (í•„ìˆ˜ ì…ë ¥, ìˆ«ì í™•ì¸)
            const fixedPrice = document.getElementById("fixedPrice");
            const dealerPrice = document.getElementById("dealerPrice");
            const costPrice = document.getElementById("costPrice");

            if (!fixedPrice.value.trim() || isNaN(fixedPrice.value)) {
                alert("ì •ì°°ê°€ëŠ” í•„ìˆ˜ì´ë©° ìˆ«ìì—¬ì•¼ í•©ë‹ˆë‹¤.");
                isValid = false;
            }

            if (!dealerPrice.value.trim() || isNaN(dealerPrice.value)) {
                alert("ë”œëŸ¬ê°€ëŠ” í•„ìˆ˜ì´ë©° ìˆ«ìì—¬ì•¼ í•©ë‹ˆë‹¤.");
                isValid = false;
            }

            if (!costPrice.value.trim() || isNaN(costPrice.value)) {
                alert("ì›ê°€ëŠ” í•„ìˆ˜ì´ë©° ìˆ«ìì—¬ì•¼ í•©ë‹ˆë‹¤.");
                isValid = false;
            }

            // ì œí’ˆ ìƒíƒœ ê²€ì¦ (`available`, `out_of_stock`, `discontinued` ì¤‘ í•˜ë‚˜)
            const productCondition = document.getElementById("productCondition");
            const validConditions = ["available", "out_of_stock", "discontinued"];
            if (!validConditions.includes(productCondition.value)) {
                alert("ì œí’ˆ ìƒíƒœëŠ” 'available', 'out_of_stock', 'discontinued' ì¤‘ í•˜ë‚˜ì—¬ì•¼ í•©ë‹ˆë‹¤.");
                isValid = false;
            }

            // ì œí’ˆ ë¬¸ì˜ì‚¬í•­ ê²€ì¦ (ìµœëŒ€ 50ì)
            const productDescription = document.getElementById("productDescription");
            if (productDescription.value.length > 50) {
                alert("ì œí’ˆ ë¬¸ì˜ì‚¬í•­ì€ 50ì ì´ë‚´ë¡œ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.");
                isValid = false;
            }

            // ì œí’ˆêµ° ê²€ì¦ (ìµœëŒ€ 50ì)
            const productFamily = document.getElementById("productFamily");
            if (productFamily.value.length > 50) {
                alert("ì œí’ˆêµ°ì€ 50ì ì´ë‚´ë¡œ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.");
                isValid = false;
            }


            return isValid;
        }
    });

    </script>

    {{>main/footer}}