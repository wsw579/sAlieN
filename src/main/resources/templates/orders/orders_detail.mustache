{{>main/header}}

<style>


/* ì§„í–‰ ìƒíƒœë°” ì»¨í…Œì´ë„ˆ */
.progress-container {
    position: relative;
    width: 100%;
    height: 70px; /* ë†’ì´ë¥¼ ì¡°ê¸ˆ ëŠ˜ë¦½ë‹ˆë‹¤ */
    margin: 20px 0;
}

.progress-bar {
    position: absolute;
    top: 38%; /* ì¤‘ì•™ ì •ë ¬ */
    left: 10%; /* Qualification ì›ì˜ ì¤‘ì•™ì—ì„œ ì‹œì‘í•˜ë„ë¡ ì¡°ì •í•©ë‹ˆë‹¤ */
    transform: translateY(-50%);
    width: 0;
    height: 10px;
    background-color: green;
    transition: width 0.4s ease;
}

.progress-steps {
    display: flex;
    justify-content: space-between;
    position: relative;
    width: 100%;
    margin: 10px 0;
    top: 50%; /* ì¤‘ì•™ ì •ë ¬ */
    transform: translateY(-50%);
}

.step {
    width: 30px;
    height: 30px;
    border: 2px solid #ccc;
    border-radius: 50%;
    position: relative;
    text-align: center;
    line-height: 30px;
    font-weight: bold;
    color: #fff;
    background-color: #ccc;
    transition: background-color 0.3s ease, border-color 0.3s ease;
}


/* í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
.step::after {
    content: attr(data-step);
    position: absolute;
    top: 40px; /* ë™ê·¸ë¼ë¯¸ ì•„ë˜ì— í…ìŠ¤íŠ¸ ë°°ì¹˜ */
    left: 50%;
    transform: translateX(-50%);
    color: #000;
    font-weight: normal;
    font-size: 14px;
}

/* ìƒíƒœë³„ ë™ê·¸ë¼ë¯¸ ìƒ‰ìƒ */
.step.none.active {
    background-color: black;
    border-color: black;
}

.step.draft.active {
    background-color: blue;
    border-color: blue;
}

.step.activated.active {
    background-color: green;
    border-color: green;
}

.step.completed.active {
    background-color: yellow;
    border-color: yellow;
}

.step.cancelled.active {
    background-color: red;
    border-color: red;
}



</style>





<div id="layoutSidenav_content">
    <main>
        <div class="container-fluid px-4">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h1 class="mt-4">Orders</h1>
                <button onclick="location.href='/orders'" class="back-btn">ğŸ”™</button>

            </div>

            <ol class="breadcrumb mb-4">
                <li class="breadcrumb-item active">Orders</li>
            </ol>

            <!-- Orders Detail -->
            <div class="card mb-4">
                <div class="card-header">
                    <i class="fas fa-table me-1"></i>
                    Orders detail
                </div>
                <div class="card-body">

                    <table id="orders_detail">
                    {{#orders}}
                    <!-- ë²„íŠ¼ ì»¨í…Œì´ë„ˆ -->
                    <div class="button-container mb-3">
                        <a href="/orders/detail/create" id="createButton" class="btn btn-custom-create btn-sm">
                            <i class="fas fa-plus-circle"></i> ì‹ ê·œ
                        </a>

                        {{#orderId}}
                            <button id = "deleteButton" class="btn btn-custom-delete btn-sm">
                                <i class="fas fa-trash-alt"></i> ì‚­ì œ
                            </button>
                        {{/orderId}}
                        <a href="/orders" class="btn btn-custom-select btn-sm" id="selectButton">
                            <i class="fas fa-list"></i> ëª©ë¡
                        </a>
                    </div>

                    <!-- í¼ ì‹œì‘ -->
                    {{#orderId}}
                    <form id="orderForm" action="/orders/detail/{{orderId}}/update" method="POST">
                    {{/orderId}}
                    {{^orderId}}
                    <form id="orderForm" action="/orders/detail/create" method="POST">
                    {{/orderId}}

                    <div class="mb-3 row">
                        <label for="orderDate" class="col-sm-2 col-form-label">ë°œì£¼ì¼ì:</label>
                        <div class="col-sm-10">
                            <input type="date" class="form-control" id="orderDate" name="orderDate" value="{{orderDate}}" required>
                        </div>
                    </div>

                    <div class="mb-3 row">
                        <label for="salesDate" class="col-sm-2 col-form-label">ë§¤ì¶œì¼ì:</label>
                        <div class="col-sm-10">
                            <input type="date" class="form-control" id="salesDate" name="salesDate" value="{{salesDate}}" required>
                        </div>
                    </div>

                    <div class="mb-3 row">
                        <label for="orderStatus" class="col-sm-2 col-form-label">ì£¼ë¬¸ìƒíƒœ:</label>
                        <div class="col-sm-10">
                            <select class="form-control" id="orderStatus" name="orderStatus" required>
                                <option value="none">none</option>
                                <option value="draft">draft</option>
                                <option value="activated">activated</option>
                                <option value="completed">completed</option>
                                <option value="cancelled">cancelled</option>
                            </select>
                        </div>
                    </div>

                    <div class="mb-3 row">
                        <label for="orderAmount" class="col-sm-2 col-form-label">ìˆ˜ëŸ‰:</label>
                        <div class="col-sm-10">
                            <input type="number" class="form-control" id="orderAmount" name="orderAmount" value="{{orderAmount}}" placeholder="ìˆ˜ëŸ‰ì„ ì…ë ¥í•˜ì„¸ìš”" required>
                        </div>
                    </div>

                        <div class="mb-3 row">
                            <label for="productId" class="col-sm-2 col-form-label">ì œí’ˆ:</label>
                            <div class="col-sm-10">
                                <select id="productId" name="productId" required>
                                    <option value="">-- ì œí’ˆ ì„ íƒ --</option>
                                    {{#products}}
                                        <option value="{{productId}}" {{#isSelected}}{{productId}}{{/isSelected}}>
                                            {{productName}} (ID: {{productId}})
                                        </option>
                                    {{/products}}
                                </select>
                            </div>
                        </div>

                        <div class="mb-3 row">
                            <label for="contractId" class="col-sm-2 col-form-label">ê³„ì•½:</label>
                            <div class="col-sm-10">
                                <select id="contractId" name="contractId" required>
                                    <option value="">-- ê³„ì•½ ì„ íƒ --</option>
                                    {{#contracts}}
                                        <option value="{{contractId}}" {{#isSelected}}{{contractId}}{{/isSelected}}>
                                            {{contractId}} (ID: {{contractId}})
                                        </option>
                                    {{/contracts}}
                                </select>
                            </div>
                        </div>

                    <div class="d-flex justify-content-end">
                        <button type="submit" id="updateButton" class="btn btn-custom-update btn-sm">
                            <i class="fas fa-save"></i> ì €ì¥
                        </button>
                    </div>
                </form> <!-- í¼ ë‹«ê¸° -->
                    {{/orders}}
                </form>
                    </table>

                </div>
            </div>


        {{#orderId}}
        <div class="card mb-4">
            <div class="card-header">
                <i class="fas fa-table me-1"></i>
                Orders Status
            </div>
            <div class="card-body">
                <table id="orders_status">


                    {{#orders}}
                        <tbody>
                        <div class="progress-container">
                            <div class="progress-steps">
                                <div class="step none" data-step="none"></div>
                                <div class="step draft" data-step="draft"></div>
                                <div class="step completed" data-step="completed"></div>
                                <div class="step activated" data-step="activated"></div>
                                <div class="step cancelled" data-step="cancelled"></div>
                            </div>
                        </div>
                        </tbody>
                    {{/orders}}
                </table>
            </div>
        </div>
        {{/orderId}}
        </div>
</main>

    <script>
        // CRUD ë©”ì‹œì§€
        {{#message}}
            alert("{{message}}");
        {{/message}}

        document.addEventListener("DOMContentLoaded", function () {
{{#orders}}

    {{#orderId}}
        // Mustache í…œí”Œë¦¿ì—ì„œ ì„œë²„ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜´
            var orderStatus = "{{orderStatus}}";
            var productId = "{{productId.productId}}";
            var contractId = "{{contractId.contractId}}";

            // í¼ì— ë°ì´í„° ì±„ìš°ê¸°
            document.getElementById("orderStatus").value = orderStatus;
            document.getElementById("productId").value = productId;
            document.getElementById("contractId").value = contractId;
    {{/orderId}}

        // Selectize ì´ˆê¸°í™”
        $('#contractId').selectize({
            create: false,
            sortField: 'text'
        });
        $('#productId').selectize({
            create: false,
            sortField: 'text'
        });

        // Form ì‚­ì œë²„íŠ¼ í´ë¦­ ì‹œ í˜„ ì£¼ì†Œê°€ createì¸ ê²½ìš° createë¡œ action ì£¼ì†Œ ë³€ê²½
        var form = document.getElementById("orderForm");
        var currentUrl = window.location.pathname;
        if (form && currentUrl === "/orders/detail/create") {
            form.action = "/orders/detail/create";
        }

        // ì €ì¥ ë²„íŠ¼ í´ë¦­ ì‹œ ë³€ê²½ì‚¬í•­ ì €ì¥ ì—¬ë¶€ í™•ì¸
        var updateButton = document.getElementById("updateButton");
        if (updateButton) {
            updateButton.addEventListener("click", function (event) {
                var confirmSave = confirm("ë³€ê²½ì‚¬í•­ì„ ì €ì¥í•˜ê² ìŠµë‹ˆê¹Œ?");
                if (!confirmSave) {
                    event.preventDefault();
                }
            });
        }

        // ìƒíƒœì— ë”°ë¥¸ ì§„í–‰ìƒí™© í‘œì‹œ
        var progressSteps = document.querySelectorAll(".step");
        var steps = ["none", "draft", "completed", "activated", "cancelled"];
        var currentIndex = steps.indexOf(orderStatus);
        if (currentIndex !== -1) {
            progressSteps[currentIndex].classList.add("active");
        }

        {{#orderId}}
            var deleteButton = document.getElementById("deleteButton");
            if (deleteButton) {
                deleteButton.addEventListener("click", function () {
                    // ì„œë²„ì—ì„œ ë Œë”ë§ëœ orderId ê°€ì ¸ì˜¤ê¸°
                    var orderId = "{{orderId}}";

                if (orderId) {
                    var confirmDelete = confirm("í˜„ì¬ í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?");
                    if (confirmDelete) {
                        fetch(`/orders/detail/${orderId}/delete`, {
                            method: "POST", // ì„œë²„ ì—”ë“œí¬ì¸íŠ¸ê°€ POSTë¥¼ ì§€ì›í•´ì•¼ í•¨
                            headers: {
                                "Content-Type": "application/json",
                            },
                            body: JSON.stringify({ id: orderId }), // ì˜¬ë°”ë¥¸ ë°ì´í„° ì „ì†¡
                        })
                            .then((response) => {
                                if (response.ok) {
                                    alert("ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
                                    window.location.href = "/orders"; // ì‚­ì œ í›„ ì´ë™
                                } else {
                                    alert("ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                                }
                            })
                            .catch((error) => {
                                console.error("Error:", error);
                                alert("ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                            });
                    }
                } else {
                    alert("ì‚­ì œí•  IDê°€ ì—†ìŠµë‹ˆë‹¤.");
                }
            });
            }
        {{/orderId}}
    });
{{/orders}}
    </script>




{{>main/footer}}